<!DOCTYPE html>

<html>
<head>
  <title>app.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.coffee
              </a>
            
              
              <a class="source" href="collection.html">
                collection.coffee
              </a>
            
              
              <a class="source" href="facets.html">
                facets.coffee
              </a>
            
              
              <a class="source" href="index.html">
                index.coffee
              </a>
            
              
              <a class="source" href="facetArray.html">
                facetArray.coffee
              </a>
            
              
              <a class="source" href="schema.html">
                schema.coffee
              </a>
            
              
              <a class="source" href="facet.html">
                facet.coffee
              </a>
            
              
              <a class="source" href="item.html">
                item.coffee
              </a>
            
              
              <a class="source" href="print.html">
                print.coffee
              </a>
            
              
              <a class="source" href="routes.html">
                routes.coffee
              </a>
            
              
              <a class="source" href="facet.html">
                facet.coffee
              </a>
            
              
              <a class="source" href="item.html">
                item.coffee
              </a>
            
              
              <a class="source" href="profile.html">
                profile.coffee
              </a>
            
              
              <a class="source" href="cube.html">
                cube.coffee
              </a>
            
              
              <a class="source" href="code.html">
                code.coffee
              </a>
            
              
              <a class="source" href="server.config.html">
                server.config.coffee
              </a>
            
              
              <a class="source" href="server.routes.html">
                server.routes.coffee
              </a>
            
              
              <a class="source" href="server.settings.html">
                server.settings.coffee
              </a>
            
              
              <a class="source" href="entityController.html">
                entityController.coffee
              </a>
            
              
              <a class="source" href="extensionController.html">
                extensionController.coffee
              </a>
            
              
              <a class="source" href="facetManager.html">
                facetManager.coffee
              </a>
            
              
              <a class="source" href="itemController.html">
                itemController.coffee
              </a>
            
              
              <a class="source" href="printController.html">
                printController.coffee
              </a>
            
              
              <a class="source" href="schema.html">
                schema.coffee
              </a>
            
              
              <a class="source" href="solrManager.html">
                solrManager.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>app.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h3>Cube App</h3>
<p>The cube is composed of a nodejs backend and a backbonejs frontend. This is
the start of the backbonejs application. Please checkout cube.coffee to
find more about the backend.</p>
<p>You can also visit our github page and repository</p>
<p><a href="http://zalando.github.io/cube/">http://zalando.github.io/cube/</a></p>
<p>@autor: Emanuel Lauria <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#x3a;&#x65;&#x6d;&#x61;&#110;&#x75;&#x65;&#108;&#46;&#108;&#97;&#x75;&#x72;&#x69;&#97;&#x40;&#x7a;&#97;&#108;&#x61;&#110;&#100;&#x6f;&#46;&#x64;&#101;">&#x65;&#x6d;&#x61;&#110;&#x75;&#x65;&#108;&#46;&#108;&#97;&#x75;&#x72;&#x69;&#97;&#x40;&#x7a;&#97;&#108;&#x61;&#110;&#100;&#x6f;&#46;&#x64;&#101;</a>
@date:  Apr/2013</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$ =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Backbone collection to hold all items from our entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@collection</span> = <span class="keyword">new</span> <span class="property">@Collection</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Facets collection, holding all facet fields.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@facets</span> = <span class="keyword">new</span> <span class="property">@Facets</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Extensions code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@extensions</span> = <span class="keyword">if</span> <span class="property">@Extensions</span> <span class="keyword">then</span> <span class="keyword">new</span> <span class="property">@Extensions</span> <span class="keyword">else</span> <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h3>Main View</h3>
<p>Holds a new user profile view, handles search and filtering
on the items collection and updates between views and collections.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="class"><span class="keyword">class</span> <span class="title">AppView</span> <span class="keyword">extends</span> <span class="title">Backbone</span>.<span class="title">View</span></span>

        el: $(<span class="string">'#app'</span>)

        events:
            <span class="string">"keyup #inputSearch"</span>            : <span class="string">"onSearchInput"</span>
            <span class="string">"click a#add.btn"</span>               : <span class="string">"addNewItem"</span>
            <span class="string">"click ul#facet ul li .field"</span>   : <span class="string">"handleFacetClick"</span>
            <span class="string">"click span#reset a"</span>            : <span class="string">"resetAllFilters"</span>
            <span class="string">"click span#view"</span>               : <span class="string">"toggleViewMode"</span>
            <span class="string">"click ul#facet li ul span.fold"</span>: <span class="string">"toggleFacetSubfields"</span>
            <span class="string">"click ul#facet&gt;li&gt;span.fold"</span>   : <span class="string">"toggleFacetNode"</span>
            <span class="string">"click ul#facet&gt;li&gt;h4"</span>          : <span class="string">"toggleFacetNode"</span>
            <span class="string">"click span#print"</span>              : <span class="string">"print"</span>
            <span class="string">"click span#json"</span>               : <span class="string">"toJson"</span>
            <span class="string">"click #entityTitle"</span>            : <span class="string">"toggleEntitiesMenu"</span>
            <span class="string">"click #columnsMenu"</span>            : <span class="string">"toggleColumnsMenu"</span>
            <span class="string">"click #columnOptions ul li"</span>    : <span class="string">"toggleColumnVisibility"</span>
            <span class="string">"click #entities ul li"</span>         : <span class="string">"redirectToEntity"</span>
            <span class="string">"click span#pageL"</span>              : <span class="string">"previousPage"</span>
            <span class="string">"click span#pageR"</span>              : <span class="string">"nextPage"</span>
            <span class="string">"click span#jumpToFirst"</span>        : <span class="string">"jumpToFirst"</span>
            <span class="string">"click span#jumpToLast"</span>         : <span class="string">"jumpToLast"</span>
            <span class="string">"click #footer li"</span>              : <span class="string">"jumpToPage"</span>
            <span class="string">"click table .th-inner"</span>         : <span class="string">"sortTable"</span>
            <span class="string">"mouseenter #columnsMenu"</span>       : <span class="string">"overColumnsMenu"</span>
            <span class="string">"mouseenter .th-inner"</span>          : <span class="string">"showColumnsBtn"</span>
            <span class="string">"mouseleave .th-inner"</span>          : <span class="string">"hideColumnsBtn"</span>
            <span class="string">"click"</span>                         : <span class="string">"documentClick"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h3>Initialize</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>        initialize: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Create router object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@router</span> = <span class="keyword">new</span> window.Routes</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Set application settings from settings.json</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setAppSettings</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Set collection settings like sort criteria or amount of rows</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setColSettings</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Set the schema ffor the entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@createSchema</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h3>Collections bindings</h3>
<p>Display any new items in the container.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.collection.bind  <span class="string">'add'</span>,      <span class="property">@addOne</span>,        @</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Updte facets whenever an item is added to the collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.collection.bind  <span class="string">'add'</span>,      <span class="property">@updateFacets</span>,  @</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Redraw items whenever the collection is resetted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.collection.bind  <span class="string">'reset'</span>,    <span class="property">@reset</span>,         @</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Draw all facets whenever the collection is resetted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.facets.bind      <span class="string">'reset'</span>,    <span class="property">@addAllFacets</span>,  @</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Get extension templates and start app on success.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@getExtensions</span> () =&gt;

                <span class="property">@start</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h3>Start</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>        start: =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Set the application&#39;s title (extension name on top left)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setAppTitle</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Start loading animation timer (1second timeout)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@showLoadingAnimation</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Set view icon&#39;s state to show current view mode (top right).
If no pictures on the schema, thumbnail view mode is disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setViewMode</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Hide the index pane or resize it to appropriate size</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setAppFacetsState</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Set Schema indexes from localStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setColumnSelection</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Create the columns menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@generateColumnsMenu</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Create the entities menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@generateEntitiesMenu</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Fetch facets and start backbone history right after. This will
route to window.Settings.Separator which in turn will fetch
items and draw app.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@initFacets</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Start app with search input text focused</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'#inputSearch'</span>).focus() <span class="keyword">unless</span> <span class="property">@isTablet</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Hide Add item button unless admin key is present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setAdminState</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Profile additional info open/close state. Default is closed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setProfileState</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Listen for arrow keys to move between items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setMoveKeybindings</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Facet collection init</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        initFacets: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Fetch facets from database</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.facets.fetch success: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Hide any ajax error on success</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="property">@hideError</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Set expanded/folded state on facet HTML index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="property">@setFacetOpenState</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>App is ready to start navigation history</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                Backbone.history.start()

            , error: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Show error icon on controls section (top right)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="property">@showError</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Settings object holds all configuration parameters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setAppSettings: () -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Entity settings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            settings = window.settings</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Etiquettes definition (etiquettes.json)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            settings.etiquettes = window.etiquettes</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Available entities</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            settings.entities = window.entities</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Global Settings object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.Settings = settings</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Set collection settings like sort and rows.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setColSettings: () -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Sort criteria (i.e. name:asc)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.collection.sort = <span class="property">@getSort</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Rows to show (default: 50)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.collection.rows = window.Settings.rows</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Set the application&#39;s title on top left corner (top entities menu)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setAppTitle: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Show name on top left corner and window title</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'#header #entityTitle h1'</span>).html window.Settings?.title</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Show arrow on title if is possible to chose other entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> window.Settings.entities.length &gt; <span class="number">1</span>
                $(<span class="string">'#header #entityTitle'</span>).addClass <span class="string">'selectable'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Set the view mode to either thumbnail or list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setViewMode: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>No picture? no thumbnail view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            pictureFields = window.Settings.Schema.getPictures()
            $(<span class="string">'span#view'</span>).hide() <span class="keyword">if</span> pictureFields.length <span class="keyword">is</span> <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Set list view as default if in settings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'span#view'</span>).addClass <span class="string">'list'</span> <span class="keyword">if</span> window.Settings?.view <span class="keyword">is</span> <span class="string">'list'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Set the facet pane state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setAppFacetsState: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Get facet fields from Schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            facets = window.Settings.Schema.getFacets()</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>If there are no facet fields, hide the facet pane</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">return</span> <span class="property">@disableFacets</span>() <span class="keyword">unless</span> facets.length</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Resize the facet pane to user preferences</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setIndexResizable</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Set the application edit capabilities</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setAdminState: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Check if entity is editable and user has provided admin key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> <span class="property">@isEditable</span>() <span class="keyword">and</span> <span class="property">@isAdmin</span>()

                $(<span class="string">'a#add.btn'</span>).css <span class="string">'display'</span>, <span class="string">'block'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Save profile state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setProfileState: () =&gt;

            window.additionalOpen = <span class="literal">no</span></pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Get extesion HTML/JS code and append it to current dom.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getExtensions: (cb) =&gt;

            $.get <span class="string">'template'</span>, (exthtml) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Append HTML on extension container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $(<span class="string">'#app &gt; #extensions'</span>).html exthtml

                <span class="keyword">return</span> cb() <span class="keyword">unless</span> $(<span class="string">"#app &gt; #extensions #controls"</span>).length</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Get extension controls and append them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                t = _.template $(<span class="string">"#app &gt; #extensions #controls"</span>).html()
                $(<span class="string">'#controls #extensions'</span>).append t({})</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Initialize extended javascript</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                window.extensions?.init?()

                cb()</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Add Profile extension code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        addProfileExtensions: (item) =&gt;

            <span class="keyword">return</span> <span class="keyword">unless</span> $(<span class="string">'#app &gt; #extensions #details-template'</span>).length

            template = _.template $(<span class="string">'#app &gt; #extensions #details-template'</span>)
                .html()

            $(<span class="string">'#pane #extensions'</span>).append template t:item</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Get schema and attach it to our Settings object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        createSchema: -&gt;

            window.Settings?.Schema = <span class="keyword">new</span> window.Schema window.schema</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Switches between list view mode and thumbnail view mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        toggleViewMode: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Choose view mode to toggle to</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            v = <span class="keyword">if</span> window.Settings.view <span class="keyword">is</span> <span class="string">'list'</span> <span class="keyword">then</span> <span class="string">'thumbnail'</span> <span class="keyword">else</span> <span class="string">'list'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Set new view mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.Settings.view = v</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Set control icon appearance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'span#view'</span>).removeClass <span class="string">'list'</span>
            $(<span class="string">'span#view'</span>).addClass <span class="string">'list'</span> <span class="keyword">if</span> v <span class="keyword">is</span> <span class="string">'list'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Redraw collection of items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@filterByPage</span> () =&gt;

                <span class="property">@scrollToSelection</span> $(<span class="string">'#items .active'</span>), <span class="literal">yes</span>

                <span class="property">@navigate</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Redraw collection after a reset event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        reset: (attr) =&gt;

            letters = $(<span class="string">"#inputSearch"</span>).val().toLowerCase()

            $(<span class="string">'#search span#reset'</span>).show()

            $(<span class="string">'#search span#reset'</span>).hide() <span class="keyword">unless</span> letters <span class="keyword">or</span> <span class="property">@filterSelection</span>
                .get().length

            <span class="keyword">return</span> <span class="property">@addAll</span> window.collection</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Add one item to the items container. Either in thumnail mode
(picture and name) or in list mode (pic, full name, teams, etc.)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        addOne: (m) =&gt;

            view = window.Settings.view

            <span class="keyword">return</span> window.App.addOneThumbnail(m) <span class="keyword">if</span> view <span class="keyword">is</span> <span class="string">'thumbnail'</span>

            window.App.addOneList m</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Add one item to the table of items (list view mode)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        addOneList: (item) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Create a new list view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            view = <span class="keyword">new</span> ItemListView model: item</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Append it to the tabel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@$</span>(<span class="string">"table tbody"</span>, <span class="string">"#items"</span>).append view.render().el</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Add one item with a thumbnail view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        addOneThumbnail: (item) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Create a new Thumbnail view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            view = <span class="keyword">new</span> ItemThumbnailView model: item</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Choose category to append it to appropriate container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            cat = item.get window.Settings.Schema.getClassifier().id
            cat = cat[<span class="number">0</span>] <span class="keyword">if</span> <span class="keyword">typeof</span> cat <span class="keyword">is</span> <span class="keyword">typeof</span> []
            cat = <span class="string">'null'</span> <span class="keyword">if</span> cat <span class="keyword">is</span> <span class="literal">undefined</span>
            cat = window.categories.indexOf cat</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Append to category container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@$</span>(<span class="string">"li\#category-<span class="subst">#{cat}</span> ul"</span>, <span class="string">'#items'</span>).append view.render().el</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Render all items in the given collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        addAll: (col, cb) =&gt;

            view = window.Settings.view

            columnsMenuIsOpen = $(<span class="string">'#columnsMenu'</span>).hasClass <span class="string">'active'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Render view mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            render = <span class="property">@renderTableView</span>
            render = <span class="property">@renderCategoryView</span> <span class="keyword">if</span> view <span class="keyword">is</span> <span class="string">'thumbnail'</span>

            render () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Add each item in the collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                col.each <span class="property">@addOne</span></pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Hide categories that ended up with no items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="property">@hideEmptyCategories</span>() <span class="keyword">if</span> view <span class="keyword">is</span> <span class="string">'thumbnail'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Set total amount of items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="property">@setTotals</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Update facet selection and items selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="property">@updateSelection</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Scroll page to closes selected item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="property">@scrollToSelection</span> $($(<span class="string">'#items .active'</span>)[<span class="number">0</span>]), <span class="literal">yes</span></pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Show columns menu if it was active before</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $(<span class="string">'#columnOptions'</span>).show() <span class="keyword">if</span> columnsMenuIsOpen
                $(<span class="string">'#columnsMenu'</span>).addClass <span class="string">'active'</span> <span class="keyword">if</span> columnsMenuIsOpen

                cb() <span class="keyword">if</span> cb</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Create an empty profileView to add an item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        addNewItem: () =&gt;

            <span class="property">@clearSelection</span>()

            <span class="property">@showProfile</span> <span class="keyword">new</span> window.Item

            window.profileView.form()

            <span class="property">@navigate</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Select one item with a normal click. Delete previous selection if
present and save selected item as the firstActiveItem</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        selectOne: ($e, attr) =&gt;

            <span class="property">@clearSelection</span>()

            <span class="property">@addToSelection</span> $e

            <span class="property">@scrollToSelection</span> $e

            <span class="property">@showProfile</span> window.collection.get($e.attr(<span class="string">'id'</span>)), attr</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Add a item to the selection array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        addToSelection: ($e) =&gt;

            id = $e.attr <span class="string">'id'</span>

            $e.addClass <span class="string">'active'</span>

            window.firstActiveItem = id <span class="keyword">if</span> <span class="property">@itemSelection</span>.length <span class="keyword">is</span> <span class="number">0</span>

            <span class="property">@itemSelection</span>.add window.collection.get id</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>On list mode, when selection is too close to top or bottom border,
do a page up/down respectively.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        scrollToSelection: ($e, center) =&gt;

            <span class="keyword">return</span> <span class="keyword">unless</span> $e.length

            posY = $e.offset().top - <span class="number">90</span>

            $container = $(<span class="string">'.fixed-table-container-inner, .thumbnailContainer'</span>)

            scrollTop = $container.scrollTop()

            height    = $container.height()

            eHeight   = <span class="keyword">if</span> window.Settings.view <span class="keyword">is</span> <span class="string">'list'</span> <span class="keyword">then</span> <span class="number">39</span> <span class="keyword">else</span> <span class="number">196</span>

            <span class="keyword">if</span> posY + eHeight &gt; height
                top = scrollTop + eHeight - (height - posY)
                top += height/<span class="number">2</span> <span class="keyword">if</span> center
                <span class="keyword">return</span> $container.scrollTop top

            <span class="keyword">if</span> posY &lt; <span class="number">0</span>
                top = scrollTop + posY + <span class="number">1</span>
                <span class="keyword">return</span> $container.scrollTop top</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Add all facets from the facet collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        addAllFacets: () =&gt;

            $(<span class="string">'ul#facet'</span>).html <span class="string">''</span>

            window.facets.each <span class="property">@addOneFacet</span>

            <span class="property">@resizeIndex</span>()

            <span class="property">@setFacetWidth</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Add one facet field with a title name and a list of values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        addOneFacet: (facet) -&gt;

            view = <span class="keyword">new</span> FacetView model: facet

            <span class="property">@$</span>(<span class="string">'ul#facet'</span>).append view.render().el</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Fetch all items for the collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fetchItems: (attr) =&gt;

            <span class="property">@showLoadingAnimation</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Unbind all item views so they get removed when HTML is replaced
TODO prob possible to remove with Backbonejs 1.0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@unbindItemViews</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Fetch items. cb() in attr.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.collection.fetch attr</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Fetch facets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        fetchFacet: (cb) =&gt;

            <span class="property">@showLoadingAnimation</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Fetch facets using current facet selection as filters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.facets.fetch</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Get parameters for request (selected facet filters)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                data: <span class="property">@getFilterQS</span>()

                success: () =&gt;

                    <span class="property">@updateFacetState</span>()
                    <span class="property">@setFacetState</span> <span class="property">@filterSelection</span>.get()
                    <span class="property">@hideError</span>()
                    cb()

                error: () =&gt;

                    <span class="property">@showError</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Fetch a paginated collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        filterByPage: (cb) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Re-fetch facets and re-apply filter selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@fetchFacet</span> () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Fetch items based on filter selection, page, etc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="property">@fetchItems</span>

                    data: <span class="property">@getFilterQS</span>()

                    success: (col) =&gt;

                        <span class="property">@trigger</span> <span class="string">'filterByFacet'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Generate page navigation (bottom right)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="property">@genPageIndex</span>()

                        <span class="property">@hideError</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Show profile view if there was any open</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="property">@showPaneView</span>()

                        <span class="property">@navigate</span>()

                        cb(col) <span class="keyword">if</span> cb

                    error: () =&gt;

                        <span class="property">@showError</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Fetch a collection by facet filter. Sets page back to 0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        filterByFacet: (cb) =&gt;

            window.collection.page = <span class="number">0</span>

            <span class="property">@filterByPage</span> cb</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Updates the facet collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        updateFacets: (m) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Re-fetch facets from DB</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@fetchFacet</span> () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Re-fetch items based on the new filter selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="property">@fetchItems</span>

                    data: <span class="property">@getFilterQS</span>()

                    success: (col) =&gt;

                        <span class="property">@genPageIndex</span>()
                        <span class="property">@hideError</span>()
                        <span class="property">@showPaneView</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>If the colection isn&#39;t empty, we are done</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="keyword">return</span> <span class="keyword">if</span> col.length</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Otherwise reset the app by clearing all filters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        $(<span class="string">'#inputSearch'</span>).val <span class="string">''</span>
                        <span class="property">@resetAllFilters</span>()

                    error: () =&gt;

                        <span class="property">@showError</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Reset all filters.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        resetAllFilters: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Useful event for extension code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@trigger</span> <span class="string">'resetFilters'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Reset the facet state selection to none</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@setFacetState</span> []</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Clear search string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.collection.search = <span class="string">''</span>
            $(<span class="string">'#inputSearch'</span>).val <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Fetch facets and items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@fetchFacet</span> () =&gt;

                <span class="property">@fetchItems</span>

                    data: <span class="property">@getFilterQS</span>()

                    success: () =&gt;

                        <span class="property">@genPageIndex</span>()
                        <span class="property">@hideError</span>()
                        <span class="property">@navigate</span>()

                    error: () =&gt;

                        <span class="property">@showError</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Reset only the facet fields but not the search or any other</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        resetFacets: (cb) =&gt;

            <span class="property">@trigger</span> <span class="string">'resetFacets'</span>

            <span class="property">@setFacetState</span> []

            <span class="property">@fetchFacet</span> () =&gt;

                <span class="property">@fetchItems</span>

                    data: <span class="property">@getFilterQS</span>()

                    success: () =&gt;

                        <span class="property">@genPageIndex</span>()
                        <span class="property">@hideError</span>()
                        cb() <span class="keyword">if</span> cb

                    error: () =&gt;
                        <span class="property">@showError</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Jump to previous page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        previousPage: () =&gt;

            <span class="keyword">return</span> <span class="keyword">if</span> window.collection.page &lt;= <span class="number">0</span>

            window.collection.page--

            <span class="property">@filterByPage</span> () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Jump to next page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        nextPage: () =&gt;

            total = window.collection.total
            rows = window.collection.rows
            lastPage = Math.ceil(total/rows) - <span class="number">1</span>

            <span class="keyword">return</span> <span class="keyword">if</span> window.collection.page &gt;= lastPage

            window.collection.page++

            <span class="property">@filterByPage</span> () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Jump to a specific page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        jumpToPage: (e) =&gt;

            $e = $(e.currentTarget)

            window.collection.page = $e.attr <span class="string">'id'</span>

            <span class="property">@filterByPage</span> () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Jump to first page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        jumpToFirst: () =&gt;

            window.collection.page = <span class="number">0</span>

            <span class="property">@filterByPage</span> () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Jump to last page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        jumpToLast: () =&gt;

            total = window.collection.total
            rows = window.collection.rows
            lastPage = Math.ceil(total/rows) - <span class="number">1</span>

            window.collection.page = lastPage

            <span class="property">@filterByPage</span> () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Generate the page index on the bottom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        genPageIndex: () =&gt;

            template = _.template $(<span class="string">'#pagination-index-template'</span>).html()
            total = parseFloat window.collection.total
            rows = parseFloat window.collection.rows
            page = parseFloat window.collection.page + <span class="number">1</span>
            first = parseFloat page * rows - rows + <span class="number">1</span>
            last = <span class="keyword">if</span> page * rows &gt; total <span class="keyword">then</span> total <span class="keyword">else</span> page * rows

            <span class="keyword">if</span> total &gt; rows
                $(<span class="string">'#content'</span>).removeClass <span class="string">'noPages'</span>
                $(<span class="string">'#footer'</span>).html template()
                <span class="keyword">return</span> $(<span class="string">'#footer'</span>).show()

            $(<span class="string">'#content'</span>).addClass <span class="string">'noPages'</span>
            $(<span class="string">'#footer'</span>).hide()</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Handle a click on a facet field. Add facet to selection, filter
with new selection and activate field</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        handleFacetClick: (e) =&gt;

            $e    = $(e.currentTarget)
            cat   = $e.attr <span class="string">'data-name'</span>
            name  = $e.attr <span class="string">'data-title'</span>

            <span class="keyword">if</span> e.ctrlKey <span class="keyword">or</span> e.altKey
                <span class="property">@filterSelection</span>.toggleMult cat: cat, field:name
            <span class="keyword">else</span>
                <span class="property">@filterSelection</span>.toggle cat:cat, field:name

            <span class="property">@showLoadingAnimation</span>()

            <span class="property">@filterByFacet</span> () =&gt;

                window.paneView?.close() <span class="keyword">if</span> <span class="property">@filterSelection</span>.get().length != <span class="number">1</span>

                $e.toggleClass <span class="string">'active'</span>

                $(<span class="string">'span.amount'</span>, $e).toggleClass <span class="string">'active'</span>

                $(<span class="string">'span#reset'</span>)
                    .show() <span class="keyword">unless</span> <span class="property">@filterSelection</span>.get().length <span class="keyword">is</span> <span class="number">0</span>

                <span class="property">@showPaneView</span>()

            $(<span class="string">'#inputSearch'</span>).focus() <span class="keyword">unless</span> <span class="property">@isTablet</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Reset filtes and set app state. User clicked on &quot;reset filters&quot; link.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        onResetFilter: () =&gt;

            <span class="property">@resetFilter</span> () =&gt;

                <span class="property">@navigate</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Set facets expanded/folded state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setFacetState: (s) =&gt;

            <span class="property">@filterSelection</span>.set s

            _.each s, (c) =&gt;

                $f = $(<span class="string">".field[data-title='<span class="subst">#{c.field}</span>']"</span>,
                  <span class="string">"ul#facet li ul\#<span class="subst">#{c.cat}</span>"</span>)
                $f.addClass <span class="string">'active'</span>
                $(<span class="string">'span.amount'</span>, $f).addClass <span class="string">'active'</span>

                $p = $f.parent()
                $(<span class="string">'&gt;span.fold'</span>, $p.parents()).addClass(<span class="string">'open'</span>).html <span class="string">''</span>
                $(<span class="string">'&gt;ul'</span>, $p.parents()).css(<span class="string">'display'</span>, <span class="string">'block'</span>)

            _.each <span class="property">@facetOpenState</span>.get(), (c) =&gt;

                $f = $(<span class="string">"li[data-name='<span class="subst">#{c.cat}</span>'][data-title='<span class="subst">#{c.field}</span>']"</span>)
                $(<span class="string">'&gt;span.fold'</span>, $f).addClass(<span class="string">'open'</span>).html <span class="string">''</span>
                $(<span class="string">'&gt;ul'</span>, $f).css(<span class="string">'display'</span>, <span class="string">'block'</span>)

            <span class="property">@showPaneView</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Update facets selection state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        updateFacetState: () =&gt;

            <span class="property">@trigger</span> <span class="string">'updateFacetState'</span>

            $(<span class="string">'#pane'</span>).hide() <span class="keyword">unless</span> window.groupView <span class="keyword">or</span> window.paneView</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>New filter selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            nf = []</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Add remaining selected filters to new filter selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            _.each <span class="property">@filterSelection</span>.get(), (c) =&gt;
                $e = $(<span class="string">"span[data-type='<span class="subst">#{c.cat}</span>'][data-title='<span class="subst">#{c.field}</span>']"</span>)
                $f = $(<span class="string">".field[data-title='<span class="subst">#{c.field}</span>']"</span>,
                      <span class="string">"ul#facet li ul\#<span class="subst">#{c.cat}</span>"</span>)
                nf.push cat: c.cat, field: c.field <span class="keyword">if</span> $f.length <span class="keyword">or</span> $e.length</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>Set filterSelection with the new selection (remaining filters)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@filterSelection</span>.set nf</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>Hide &#39;reset filters&#39; link unless there are filters selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'span#reset'</span>).hide() <span class="keyword">unless</span> nf.length</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Forms an array of facet field parameters to put in the querystring</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getFilterQS: (state) =&gt;

            s = state || <span class="property">@filterSelection</span>.get()

            data = {fs: [] }

            _.each s, (f) -&gt; data.fs.push <span class="string">"<span class="subst">#{f.cat}</span>:<span class="subst">#{f.field}</span>"</span>

            data</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Query URL to get a filtered collection of items from the Solr DB.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        commonURL: (page, rows) =&gt;

            url = <span class="string">"collection/"</span>

            fs = []

            fs.push <span class="string">"page=<span class="subst">#{page}</span>"</span> <span class="keyword">if</span> page <span class="keyword">isnt</span> <span class="literal">undefined</span>
            fs.push <span class="string">"rows=<span class="subst">#{rows}</span>"</span> <span class="keyword">if</span> rows <span class="keyword">isnt</span> <span class="literal">undefined</span>
            fs.push <span class="string">"sort=<span class="subst">#{window.collection.sort}</span>"</span>

            _.each window.Settings.Schema.getFacets(), (field) -&gt;
                fs.push <span class="string">'facet.field='</span> + field.id

            url += <span class="string">'?'</span> + fs.join <span class="string">'&amp;'</span> <span class="keyword">if</span> fs.length

            url</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Trigger a search when users presses a key in the input search field.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        onSearchInput: (e) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Disable keys like ctrl, alt, shift from trigerring a search.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            disabledKeys =
                [ <span class="number">18</span>, <span class="number">17</span>, <span class="number">16</span>, <span class="number">9</span>, <span class="number">20</span>, <span class="number">27</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span> ]

            keyIndex = disabledKeys.indexOf e.keyCode

            <span class="keyword">if</span> e.keyCode <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">unless</span> keyIndex <span class="keyword">is</span> -<span class="number">1</span>

            <span class="property">@search</span>()

            <span class="property">@navigate</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Perform a search operation on the collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        search: (attr) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>Get lowercased string from search input field</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            letters = $(<span class="string">"#inputSearch"</span>).val().toLowerCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Avoid trigerring search if collection is already filtered by it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">return</span> <span class="keyword">if</span> window.collection.search <span class="keyword">is</span> letters</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>Show &#39;reset filters&#39; link</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'#search span#reset'</span>).show()
            $(<span class="string">'#search span#reset'</span>).hide() <span class="keyword">unless</span> letters <span class="keyword">or</span> <span class="property">@filterSelection</span>
                .get().length</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>Prepare item views to be removed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@unbindItemViews</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>Set new search string in the collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.collection.search = letters</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>Reset page to first page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.collection.page = <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>Filter collection with new search string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@filterByFacet</span> () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>Sort table when clicking on header. Toggle asc/desc modes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        sortTable: (e) =&gt;

            $e = $(e.currentTarget)
            $h = $e.parent()
            id = $h.attr <span class="string">'id'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Remove all sort indicators (background and arrow) on headers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            _.each $h.siblings(), (s) -&gt;
                $(<span class="string">'.th-inner'</span>, s).removeClass(<span class="string">'asc desc'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>Add sort indicator (arrow) appropriately</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> $e.hasClass <span class="string">'asc'</span> <span class="keyword">then</span> $e.removeClass(<span class="string">'asc'</span>).addClass(<span class="string">'desc'</span>)
            <span class="keyword">else</span> $e.removeClass(<span class="string">'desc'</span>).addClass(<span class="string">'asc'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>Toggle sort orer in collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            order = <span class="string">'asc'</span>
            order = <span class="string">'desc'</span> <span class="keyword">if</span> $e.hasClass <span class="string">'desc'</span>
            window.collection.sort = <span class="string">"<span class="subst">#{id}</span>:<span class="subst">#{order}</span>"</span>
            window.collection.page = <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>Save sort preference on localStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@saveSort</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>Refetch collection based on new sort order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@filterByFacet</span> () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>Save sort criteria on localStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        saveSort: () -&gt;

            entity = window.Settings.entity

            ls = window.localStorage[entity]
            ls = <span class="keyword">if</span> ls <span class="keyword">then</span> JSON.parse ls <span class="keyword">else</span> {}
            ls.sort = {} <span class="keyword">unless</span> ls.sort
            ls.sort = window.collection.sort

            window.localStorage[entity] = JSON.stringify ls</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>Get sort criteria from localStorage or default configuration.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getSort: () =&gt;

            entity = window.Settings.entity

            <span class="keyword">return</span> window.Settings.sort <span class="keyword">unless</span> window.localStorage[entity]

            ls = JSON.parse window.localStorage[entity]

            <span class="keyword">return</span> window.Settings.sort <span class="keyword">unless</span> ls.sort

            <span class="keyword">return</span> ls.sort</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Open/Close a facet section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        toggleFacetNode: (e) =&gt;

            $e = $(e.currentTarget)
            $e = $e.siblings(<span class="string">'span'</span>) <span class="keyword">unless</span> $e.hasClass <span class="string">'fold'</span>
            $ul = $e.siblings(<span class="string">'ul'</span>)
            cat = $ul.attr <span class="string">'id'</span>

            <span class="keyword">if</span> $e.hasClass <span class="string">'open'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>Collapse facet node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $ul.hide()
                <span class="property">@facetOpenState</span>.toggle cat: cat, field: <span class="string">'facet'</span>
                <span class="property">@saveFacetOpenState</span>()
                <span class="keyword">return</span> $e.removeClass(<span class="string">'open'</span>).html <span class="string">'+'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Expand facet node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $ul.css(<span class="string">'display'</span>, <span class="string">'block'</span>)
            <span class="property">@facetOpenState</span>.push cat: cat, field: <span class="string">'facet'</span>
            $e.addClass(<span class="string">'open'</span>).html <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Save facet state on localStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@saveFacetOpenState</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Handles expansion and collapse of facet fields when clicking on &#39;+&#39;
or &#39;-&#39; icons next to the facet field label.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        toggleFacetSubfields: (e) =&gt;

            $e  = $(e.currentTarget)
            $p = $e.parent()
            cat = $p.attr <span class="string">'data-name'</span>
            field = $p.attr <span class="string">'data-title'</span>

            <span class="keyword">if</span> $e.hasClass <span class="string">'open'</span>
                $(<span class="string">"ul[data-name='<span class="subst">#{cat}</span>'][data-title='<span class="subst">#{field}</span>']"</span>, $p).hide()
                $e.removeClass <span class="string">'open'</span>
                <span class="property">@facetOpenState</span>.toggle cat:cat, field:field
                <span class="keyword">return</span> $e.removeClass(<span class="string">'open'</span>).html <span class="string">'+'</span>

            <span class="property">@facetOpenState</span>.push cat: cat, field: field
            $(<span class="string">"ul[data-name='<span class="subst">#{cat}</span>'][data-title='<span class="subst">#{field}</span>']"</span>, $p).show()
            $e.addClass(<span class="string">'open'</span>).html <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>Show a detailed view of an item in the rightmost pane</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showProfile: (item) =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>Destroy a groupView if any</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.groupView?.destroy()</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Create paneView with item data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            window.profileView = <span class="keyword">new</span> ProfileView model: item</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Render profile View</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'#pane'</span>).html window.profileView.render().el</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>Shrink table to make space for the profile view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'#tableContainer, #thumbnailContainer'</span>).addClass <span class="string">'onProfile'</span>
            $(<span class="string">'#footer, #columnsSelectWrapper'</span>).addClass <span class="string">'onProfile'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>Add extension code to the profileView</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@addProfileExtensions</span> item</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>Show a Group view when many items have been selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showGroupView: () =&gt;

            window.profileView?.destroy()

            window.groupView = <span class="keyword">new</span> GroupView <span class="keyword">unless</span> window.groupView

            $(<span class="string">'#pane'</span>).css(<span class="string">'display'</span>, <span class="string">'block'</span>).html window.groupView.render().el

            <span class="property">@navigate</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>Show a customazible view on the right pane for a selected facet. This
could be understood as a detailed pane for a selected facet.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showPaneView: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>profileViews and groupViews have preference over pane views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">return</span> <span class="keyword">if</span> window.profileView <span class="keyword">or</span> window.groupView</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>Only show paneView when just 1 facet is selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">return</span> <span class="keyword">if</span> <span class="property">@filterSelection</span>.get().length <span class="keyword">isnt</span> <span class="number">1</span>

            { field, cat } = <span class="property">@filterSelection</span>.get()[<span class="number">0</span>]

            <span class="keyword">return</span> window.paneView?.close() <span class="keyword">unless</span> window.pdata[cat]?[field]

            template = _.template $(<span class="string">"#app &gt; #extensions #pane-template"</span>).html()

            window.paneView = <span class="keyword">new</span> PaneView template, t: window.pdata[cat][field]

            $(<span class="string">'#pane'</span>).css(<span class="string">'display'</span>, <span class="string">'block'</span>).html window.paneView.render().el</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>Close pane only after successfull reset of facets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(window.paneView.el).bind <span class="string">'close'</span>, () =&gt;
                $(window.paneView.el).unbind <span class="string">'close'</span>
                <span class="property">@resetFacets</span> () =&gt;
                    window.paneView?.close()</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>ProfileClosed event notifies when a profile has been closed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        profileClosed: () =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>Catch this in your extension code!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="property">@trigger</span> <span class="string">'profileClosed'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>Destroy all item views, unbinding and removing html elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        removeItemViews: () -&gt;

            window.collection.each (item) -&gt;

                item.view?.destroy()</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>Unbind all item views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        unbindItemViews: () -&gt;

            window.collection.each (item) -&gt;

                item.view?.release()</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>Renders containers for each category on the thumbnail view mode.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        renderCategoryView: (cb) =&gt;

            c = window.Settings.Schema.getClassifier()

            onProfile = <span class="string">''</span>
            onProfile = <span class="string">'onProfile'</span> <span class="keyword">if</span> window.paneView <span class="keyword">or</span> window.profileView

            html = <span class="string">"&lt;ul class='thumbnailContainer <span class="subst">#{onProfile}</span>'&gt;&lt;/div&gt;"</span>
            $(<span class="string">'#items'</span>).html html

            window.facets?.each (facet) =&gt;

                <span class="keyword">return</span> <span class="keyword">unless</span> facet.get(<span class="string">'name'</span>) <span class="keyword">is</span> c.id

                window.categories = []

                template = _.template $(<span class="string">'#category-template'</span>).html()

                presentCategories = _.extend {},

                    facet.get(<span class="string">'fields'</span>).normal, facet.get(<span class="string">'fields'</span>).special</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>Add the present categoriesin that have a predefined order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                _.each c.classifier, (cat) =&gt;
                    <span class="keyword">if</span> window.App.isCatInCats cat, presentCategories
                        <span class="keyword">if</span> window.categories.indexOf(cat) <span class="keyword">is</span> -<span class="number">1</span>
                            window.categories.push(cat)
                        <span class="keyword">delete</span> presentCategories[cat]</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>Add all other present categories</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                _.each presentCategories, (amount, cat) =&gt;
                    <span class="keyword">return</span> <span class="keyword">if</span> cat <span class="keyword">is</span> <span class="string">'null'</span>
                    window.categories.push cat</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>Lastly, add &#39;not set&#39; category</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                window.categories.push <span class="string">'null'</span> <span class="keyword">if</span> presentCategories[<span class="string">'null'</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>Generate categories based on calculated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                _.each window.categories, (category, index) =&gt;
                    $(<span class="string">'#items .thumbnailContainer'</span>).append template
                        cat: category
                        index: index
                cb()</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>Renders a table to show items in &#39;list&#39; view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        renderTableView: (cb) =&gt;

            $(<span class="string">'#items'</span>).html <span class="string">''</span>

            classes = <span class="string">"onProfile"</span> <span class="keyword">if</span> window.paneView <span class="keyword">or</span> window.groupView

            $(<span class="string">'#items'</span>).append _.template $(<span class="string">'#table-template'</span>).html(),
                h: window.Settings.Columns
                classes: classes

            cb()</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>Hide empty categories on thumbnail view after all items were added.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        hideEmptyCategories: () =&gt;

            $(<span class="string">"#items li ul"</span>).each (i, cat) -&gt;

                $($(cat).parent()).show()

                $($(cat).parent()).hide() <span class="keyword">if</span> $(cat).find(<span class="string">'li'</span>).length <span class="keyword">is</span> <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>Set the amount of items in the collection on the <em> next to the
inputSearch field and on each category title</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setTotals: (total) =&gt;
            _.each $(<span class="string">'#items ul'</span>), (ul) =&gt;
                amount = $(ul).find(<span class="string">'li'</span>).length
                $(<span class="string">'em'</span>, $(ul).siblings(<span class="string">'label'</span>)).html amount

            <span class="keyword">return</span> $(<span class="string">'span#total'</span>).html total <span class="keyword">unless</span> total <span class="keyword">is</span> <span class="literal">undefined</span>
            $(<span class="string">'span#total'</span>).html window.collection.total

            $(<span class="string">'#search label'</span>).html <span class="property">@getItemType</span>() + <span class="string">' found'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>Returns the tag of the items on the search label. i.e. people, items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getItemType: () =&gt;
            itemType = window.Settings.itemType[<span class="number">1</span>]
            <span class="keyword">if</span> window.collection.length <span class="keyword">is</span> <span class="number">1</span>
                itemType = window.Settings.itemType[<span class="number">0</span>]
            <span class="keyword">return</span> itemType</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>Utility to determine if the given category for a item is listed in
the predefined categories or not. It is not about felines!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        isCatInCats: (cat, cats) =&gt;
            <span class="keyword">return</span> <span class="literal">yes</span> <span class="keyword">unless</span> cats[cat] <span class="keyword">is</span> <span class="literal">undefined</span> <span class="keyword">or</span> cats[cat] <span class="keyword">is</span> <span class="literal">null</span>
            <span class="keyword">return</span> <span class="literal">no</span></pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>After a change in the collection, re-selects items that remained</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        updateSelection: () =&gt;
            <span class="property">@hideLoadingAnimation</span>()
            <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@itemSelection</span>.length
            <span class="keyword">return</span> <span class="keyword">if</span> window.profileView
            <span class="keyword">if</span> <span class="property">@itemSelection</span>.length <span class="keyword">and</span> window.groupView
                <span class="keyword">return</span> <span class="property">@showGroupView</span>()
            window.groupView?.destroy()
            <span class="property">@clearSelection</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>Deselect all items and clear selection array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        clearSelection: () =&gt;
            $(<span class="string">'.active'</span>, <span class="string">'#items'</span>).removeClass <span class="string">'active'</span>
            <span class="property">@itemSelection</span> = <span class="keyword">new</span> window.Collection
            <span class="property">@navigate</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>Check if admin key is present in QS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        isAdmin: () =&gt;
            <span class="keyword">return</span> <span class="literal">yes</span> <span class="keyword">if</span> window.Settings.editable <span class="keyword">is</span> <span class="literal">true</span>
            qs = window.location.search.split(<span class="string">'?'</span>)[<span class="number">1</span>]
            <span class="keyword">new</span> RegExp(<span class="string">'admin='</span>).test qs</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>Check if the entity is editable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        isEditable: () =&gt;
            <span class="keyword">return</span> <span class="literal">yes</span> <span class="keyword">if</span> window.Settings.editable <span class="keyword">isnt</span> <span class="literal">false</span>
            <span class="literal">no</span></pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>Set browsers URL to point to the current application state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        navigate: (attr) =&gt;
            url =  <span class="string">'qs/?'</span> + <span class="property">@navigateURL</span>().join(<span class="string">'&amp;'</span>)
            <span class="property">@router</span>.navigate url, attr</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>Form QS from current application state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        navigateURL: () =&gt;
            page = window.collection.page
            rows = window.collection.rows
            sort = window.collection.sort
            nav = [<span class="string">"page=<span class="subst">#{page}</span>&amp;rows=<span class="subst">#{rows}</span>&amp;sort=<span class="subst">#{sort}</span>"</span>]
            id = <span class="string">''</span>
            fs = <span class="string">''</span>
            search = <span class="string">''</span>

            <span class="property">@setWindowTitle</span>()

            <span class="keyword">if</span> <span class="property">@filterSelection</span>.get().length
                f = []
                _.each <span class="property">@filterSelection</span>.get(), (facet) -&gt;
                    cat = encodeURIComponent facet.cat
                    field = encodeURIComponent facet.field
                    f.push <span class="string">"<span class="subst">#{cat}</span>:<span class="subst">#{field}</span>"</span>
                fs = <span class="string">'fs='</span> + f.join <span class="string">'|'</span>

                <span class="property">@setWindowTitle</span> <span class="string">"<span class="subst">#{f.join()}</span>"</span>

            <span class="keyword">if</span> window.profileView
                id = window.profileView.model.id || <span class="string">'new'</span>
                <span class="property">@setWindowTitle</span> window.profileView.model?.getTitle()

            <span class="keyword">else</span> <span class="keyword">if</span> window.groupView
                id = []
                <span class="property">@itemSelection</span>.each (m) =&gt;
                    id.push m.get <span class="string">'id'</span>
                id = id.join <span class="string">'|'</span>
                <span class="keyword">if</span> <span class="property">@itemSelection</span>.length <span class="keyword">is</span> <span class="number">1</span>
                    id = <span class="string">'|'</span> + <span class="property">@itemSelection</span>.models[<span class="number">0</span>].id
                <span class="property">@setWindowTitle</span> <span class="string">"Group"</span>

            search = $(<span class="string">'#inputSearch'</span>).val().toLowerCase()

            nav.push <span class="string">"id=<span class="subst">#{id}</span>"</span> <span class="keyword">if</span> id
            nav.push fs <span class="keyword">if</span> fs
            <span class="keyword">if</span> window.Settings.view <span class="keyword">isnt</span> <span class="string">"list"</span>
                nav.push <span class="string">"view=<span class="subst">#{window.Settings.view}</span>"</span>
            nav.push <span class="string">"s=<span class="subst">#{encodeURI(search)}</span>"</span> <span class="keyword">if</span> search

            nav</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>Item selection by using arrow keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setMoveKeybindings: () =&gt;

            <span class="property">@unsetMoveKeybindings</span>()

            $(<span class="string">'body'</span>).keyup <span class="property">@arrowUp</span>
            $(<span class="string">'body'</span>).keydown  <span class="property">@arrowDown</span></pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>Unbind to stop responding to keypress events for movement</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        unsetMoveKeybindings: () =&gt;

            $(<span class="string">'body'</span>).unbind <span class="string">'keyup'</span>, <span class="property">@arrowUp</span>

            $(<span class="string">'body'</span>).unbind <span class="string">'keydown'</span>, <span class="property">@arrowDown</span></pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>Select item above currently selected item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        arrowUp: (e) =&gt;

            <span class="property">@app</span> = window.App

            selectedId = <span class="property">@app</span>.itemSelection?.models[<span class="number">0</span>]?.id

            elem = $(<span class="string">"#<span class="subst">#{selectedId}</span>"</span>, <span class="string">'#items'</span>)

            <span class="keyword">if</span>  (e.which <span class="keyword">is</span> <span class="number">37</span> <span class="keyword">or</span> e.which <span class="keyword">is</span> <span class="number">38</span>) <span class="keyword">and</span> elem.prev().length
                <span class="property">@app</span>.selectOne $(<span class="string">"#<span class="subst">#{selectedId}</span>"</span>, <span class="string">'#items'</span>)
                    .prev()

            <span class="keyword">if</span>  (e.which <span class="keyword">is</span> <span class="number">39</span> <span class="keyword">or</span> e.which <span class="keyword">is</span> <span class="number">40</span>) <span class="keyword">and</span> elem.next().length
                <span class="property">@app</span>.selectOne $(<span class="string">"#<span class="subst">#{selectedId}</span>"</span>, <span class="string">'#items'</span>)
                    .next()

            <span class="property">@app</span>.navigate()</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>Select item below currently selected item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        arrowDown: (e) =&gt;

            <span class="property">@app</span> = window.App

            <span class="keyword">return</span> <span class="keyword">unless</span> <span class="property">@app</span>.itemSelection.length

            <span class="keyword">return</span> <span class="literal">false</span> <span class="keyword">if</span> e.which &gt;= <span class="number">37</span> &amp;&amp; e.which &lt;= <span class="number">40</span></pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>Show a loading wheel in the middle of the items container, if the
items havent been rendered after 1 second</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showLoadingAnimation: () =&gt;

            <span class="keyword">return</span> <span class="keyword">if</span> <span class="property">@loadingAnimation</span>

            <span class="property">@loadingAnimation</span> = setTimeout () =&gt;
                $(<span class="string">'span#loading'</span>).show()
              ,
                <span class="number">1000</span></pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>Display error icon on controls section (top right corner)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showError: () =&gt;

            <span class="property">@hideLoadingAnimation</span>()

            $(<span class="string">'span#error'</span>).show()</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>Hide error icon</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        hideError: () =&gt;

            $(<span class="string">'span#error'</span>).hide()</pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>Hide the loading animation wheel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        hideLoadingAnimation: () =&gt;

            clearTimeout <span class="property">@loadingAnimation</span>

            <span class="property">@loadingAnimation</span> = <span class="literal">null</span>

            $(<span class="string">'span#loading'</span>).hide()</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>Parses a given Date into a readable formatted string (DD MMMM YYYY)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        formatDate: (date) =&gt;

            <span class="keyword">if</span> <span class="keyword">typeof</span> date <span class="keyword">is</span> <span class="keyword">typeof</span> [] <span class="keyword">then</span> date = date[<span class="number">0</span>]

            <span class="keyword">return</span> <span class="string">''</span> <span class="keyword">unless</span> date

            monthNames = [ <span class="string">"Jan"</span>, <span class="string">"Feb"</span>, <span class="string">"Mar"</span>, <span class="string">"Apr"</span>, <span class="string">"May"</span>, <span class="string">"Jun"</span>, <span class="string">"Jul"</span>,
                <span class="string">"Aug"</span>, <span class="string">"Sep"</span>, <span class="string">"Oct"</span>, <span class="string">"Nov"</span>, <span class="string">"Dec"</span> ]

            d = <span class="keyword">new</span> Date date
            d = [ d.getDate(), monthNames[d.getMonth()], d.getFullYear() ]
            d.join <span class="string">' '</span></pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>Show print view on a new window/ab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        print: () =&gt;

            url = [ <span class="string">"page=<span class="subst">#{window.collection.page}</span>"</span> ]

            url.push <span class="string">"rows=<span class="subst">#{window.collection.total}</span>"</span>

            url.push <span class="string">"id=<span class="subst">#{window.profileView.model.id}</span>"</span> <span class="keyword">if</span> window.profileView

            url.push <span class="string">"id=<span class="subst">#{@groupIds()}</span>"</span> <span class="keyword">if</span> window.groupView

            url = url.join <span class="string">'&amp;'</span>

            window.open <span class="string">'print?'</span> + url, <span class="string">'_blank'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>Export items to json on a new tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        toJson: () =&gt;

            url = <span class="string">"<span class="subst">#{@commonURL(<span class="number">0</span>, window.collection.total)}</span>"</span>

            <span class="keyword">if</span> <span class="property">@getFilterQS</span>().fs.length
                url += <span class="string">'?'</span>
                _.each <span class="property">@getFilterQS</span>().fs, (f) =&gt;  url += <span class="string">"&amp;fs=<span class="subst">#{f}</span>"</span>

            url += <span class="string">"&amp;json=true"</span>

            id = window.profileView?.model.id

            url = <span class="string">"collection/<span class="subst">#{id}</span>"</span> <span class="keyword">if</span> window.profileView

            url = <span class="string">"collection/<span class="subst">#{@groupIds()}</span>"</span> <span class="keyword">if</span> window.groupView

            window.open url, <span class="string">'_blank'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>Hide facets container on the left</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        disableFacets: () -&gt;

            $(<span class="string">'#index'</span>).hide()

            $(<span class="string">'#content'</span>).addClass <span class="string">'noFacets'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>Create the entities menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        generateEntitiesMenu: () -&gt;

            entities = window.Settings.entities

            _.each entities, (e) -&gt;

                <span class="keyword">return</span> <span class="keyword">if</span> e <span class="keyword">is</span> window.Settings.entity

                o = <span class="string">"&lt;li id='<span class="subst">#{e}</span>'&gt;&lt;span&gt;<span class="subst">#{e}</span>&lt;/span&gt;&lt;/li&gt;"</span>
                $(<span class="string">"#entities ul"</span>, <span class="string">"#header"</span>).append o</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>Hide entities menu if only one entity available</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="string">'#entityTitle span'</span>).hide() <span class="keyword">if</span> entities.length <span class="keyword">is</span> <span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>Redirect to an entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        redirectToEntity: (e) -&gt;

            entity = $(e.currentTarget).attr <span class="string">'id'</span>

            adminKey = <span class="keyword">if</span> <span class="property">@isAdmin</span>() <span class="keyword">then</span> <span class="string">"?admin=yes"</span> <span class="keyword">else</span> <span class="string">''</span>

            window.location = <span class="string">"/<span class="subst">#{entity}</span>/<span class="subst">#{adminKey}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <p>Create the columns menu that allows a user to choose visible colums
of the table on the list view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        generateColumnsMenu: () -&gt;

            template = _.template $(<span class="string">'#columns-menu-template'</span>).html()

            _.each window.Settings.Schema.get(), (field) =&gt;

                $(<span class="string">'#columnOptions ul'</span>).append template field: field</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>Open/Close entities menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        toggleEntitiesMenu: (e) -&gt;

            e.stopPropagation()

            <span class="keyword">return</span> <span class="keyword">unless</span> window.Settings.entities.length &gt; <span class="number">1</span>

            $(<span class="string">'#entityTitle'</span>, <span class="string">'#header'</span>).toggleClass <span class="string">'active'</span>

            $(<span class="string">"#entities"</span>, <span class="string">"#header"</span>).toggle()</pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>Hide entities menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        hideEntitiesMenu: (e) -&gt;

            $(<span class="string">'#entityTitle'</span>, <span class="string">'#header'</span>).removeClass <span class="string">'active'</span>

            $(<span class="string">'#entities'</span>, <span class="string">'#header'</span>).hide()</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>Show columns button on top right corner of table view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showColumnsBtn: (e) -&gt;

            $(<span class="string">'#columnsMenu'</span>).show()</pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>Hide columns button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        hideColumnsBtn: (e) -&gt;

            <span class="keyword">return</span> <span class="keyword">if</span> $(<span class="string">'#columnOptions'</span>).css(<span class="string">'display'</span>) <span class="keyword">is</span> <span class="string">'block'</span>

            $(<span class="string">'#columnsMenu'</span>).hide()</pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <p>Show columns menu button on hover</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        overColumnsMenu: (e) -&gt;

            $(<span class="string">'#columnsMenu'</span>).show()

            e.stopPropagation()</pre></div></div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              <p>Open/Close columns menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        toggleColumnsMenu: (e) -&gt;

            e.stopPropagation()

            $(<span class="string">'#columnOptions'</span>).toggle()

            $(<span class="string">'#columnsMenu'</span>).toggleClass <span class="string">'active'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>Show/hide a column from the table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        toggleColumnVisibility: (e) -&gt;

            e.stopPropagation()

            $e = $(e.currentTarget)
            id = $e.attr <span class="string">'id'</span>

            <span class="keyword">if</span> $e.hasClass <span class="string">'active'</span>
                _.each window.Settings.Schema.get(), (f) =&gt;
                    <span class="keyword">if</span> f.id <span class="keyword">is</span> id <span class="keyword">then</span> f.index = <span class="literal">false</span>
                $e.removeClass <span class="string">'active'</span>
                <span class="property">@saveColumnSelection</span>()
                <span class="keyword">return</span> <span class="property">@addAll</span> window.collection

            _.each window.Settings.Schema.get(), (f) =&gt;
                <span class="keyword">if</span> f.id <span class="keyword">is</span> id <span class="keyword">then</span> f.index = <span class="literal">true</span>

            $e.addClass <span class="string">'active'</span>

            <span class="property">@saveColumnSelection</span>()

            <span class="property">@addAll</span> window.collection</pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <p>Set the title for the window</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setWindowTitle: (t) -&gt;

            title = window.Settings?.title

            title += <span class="string">" - <span class="subst">#{t}</span>"</span> <span class="keyword">if</span> t

            $(<span class="string">'head title'</span>).html title</pre></div></div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>Set resizable handler for facet index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setIndexResizable: () =&gt;

            $(<span class="string">'#index'</span>).resizable

                handles: <span class="string">'e'</span>
                resize: <span class="property">@resizeIndex</span>
                stop: <span class="property">@saveFacetWidth</span></pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>Get Facet index Width</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getIndexWidth: () =&gt;

            w = $(<span class="string">'#index'</span>).width()

            <span class="keyword">return</span> w <span class="keyword">if</span> w

            entity = window.Settings.entity

            <span class="keyword">return</span> <span class="keyword">unless</span> window.localStorage[entity]

            ls = JSON.parse window.localStorage[entity]
            w = parseFloat ls.css?.facet_width

            w</pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>Resize facet index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        resizeIndex: (event, ui) =&gt;

            w = window.App.getIndexWidth()

            $(<span class="string">'#content'</span>).css <span class="string">'left'</span>, w + <span class="number">21</span>
            $(<span class="string">'#footer'</span>).css <span class="string">'left'</span>, w + <span class="number">21</span>
            $(<span class="string">'#innerIndex'</span>).width w - <span class="number">10</span></pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <p>Save column selection on local storage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        saveColumnSelection: () =&gt;

            entity = window.Settings.entity

            ls = window.localStorage[entity]
            ls = <span class="keyword">if</span> ls <span class="keyword">then</span> JSON.parse ls <span class="keyword">else</span> {}

            indexes = []
            _.each window.Settings.Schema.getIndexes(), (s) -&gt;
                indexes.push s.id
            ls.columns = {} <span class="keyword">unless</span> ls.columns
            ls.columns = indexes

            window.localStorage[entity] = JSON.stringify ls</pre></div></div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              <p>Set column selection from localStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setColumnSelection: () =&gt;

            entity = window.Settings.entity

            ls = window.localStorage[entity]
            <span class="keyword">return</span> <span class="keyword">unless</span> ls

            ls = JSON.parse ls
            columns = ls.columns
            <span class="keyword">return</span> <span class="keyword">unless</span> ls.columns

            _.each window.Settings.Schema.getIndexes(), (i) -&gt;
                i.index = <span class="literal">no</span>

            _.each columns, (c) -&gt;
                window.Settings.Schema.getField c, (f) -&gt;
                    f.index = <span class="literal">yes</span></pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <p>Save width of facet index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        saveFacetWidth: (event, ui) =&gt;

            entity = window.Settings.entity

            ls = window.localStorage[entity]
            ls = <span class="keyword">if</span> ls <span class="keyword">then</span> JSON.parse ls <span class="keyword">else</span> {}

            w = $(<span class="string">'#index'</span>).width()

            ls.css = {} <span class="keyword">unless</span> ls.css
            ls.css[<span class="string">'facet_width'</span>] = w

            window.localStorage[entity] = JSON.stringify ls</pre></div></div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              <p>Set Facet index width from localStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setFacetWidth: () =&gt;

            entity = window.Settings.entity

            <span class="keyword">return</span> <span class="keyword">unless</span> window.localStorage[entity]

            ls = JSON.parse window.localStorage[entity]
            w = parseFloat ls.css?.facet_width

            $(<span class="string">'#index'</span>).width w <span class="keyword">if</span> w

            <span class="property">@resizeIndex</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>Get an etiquette object with its ID</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getEtiquetteById: (id) =&gt;

            etq = <span class="literal">null</span>

            _.each window.Settings.etiquettes, (e) -&gt;
                <span class="keyword">return</span> etq = e <span class="keyword">if</span> e.id <span class="keyword">is</span> id

            etq</pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>Get a mini etiquette for the pic in the table view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getMiniEtiquette: (etiquettes) =&gt;

            etq = <span class="literal">null</span>

            _.each etiquettes, (e) =&gt;

                e = <span class="property">@getEtiquetteById</span> e

                etq = e <span class="keyword">unless</span> etq <span class="keyword">or</span> !e?.mini

            etq</pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>Determines etiquettes for a given item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getItemEtiquettes: (model) =&gt;

            <span class="keyword">return</span> <span class="keyword">unless</span> window.Settings.Schema.getTuples().length

            facet = window.App.filterSelection.get()[<span class="number">0</span>]
            tuple = window.Settings.Schema.getTuples()[<span class="number">0</span>].id
            [team, role] = tuple.split(<span class="string">':'</span>) <span class="comment">#team</span>

            etiquettes = []

            _.each model.get(tuple), (t) =&gt;

                [ mteam, mrole ] = t.split(<span class="string">':'</span>)

                _.each mrole.split(<span class="string">','</span>), (r) =&gt;

                    <span class="keyword">return</span> <span class="keyword">if</span> etiquettes.indexOf($.trim(r)) <span class="keyword">isnt</span> -<span class="number">1</span>

                    etiquettes.push $.trim r

            etiquettes = <span class="property">@sortEtiquettes</span> etiquettes

            etiquettes</pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <p>Sort etiquettes from etiquettes.json order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        sortEtiquettes: (etiquettes) =&gt;

            ordered = []

            _.each window.etiquettes, (e) =&gt;

                ordered.push e.id <span class="keyword">if</span> etiquettes.indexOf(e.id) <span class="keyword">isnt</span> -<span class="number">1</span>

            _.each etiquettes, (e) =&gt;

                ordered.push e <span class="keyword">if</span> ordered.indexOf(e) <span class="keyword">is</span> -<span class="number">1</span>

            ordered</pre></div></div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              <p>Save open/closed state of facets on localStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        saveFacetOpenState: () =&gt;

            entity = window.Settings.entity

            ls = window.localStorage[entity]
            ls = <span class="keyword">if</span> ls <span class="keyword">then</span> JSON.parse ls <span class="keyword">else</span> {}
            ls.facetOpenState = <span class="property">@facetOpenState</span>.get()

            window.localStorage[entity] = JSON.stringify ls</pre></div></div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              <p>Set facet open/closed state of facets on localStorage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setFacetOpenState: () =&gt;

            entity = window.Settings.entity

            <span class="keyword">return</span> <span class="property">@initFacetOpenState</span>() <span class="keyword">unless</span> window.localStorage[entity]

            ls = JSON.parse window.localStorage[entity]
            fs = ls.facetOpenState

            <span class="keyword">return</span> <span class="property">@initFacetOpenState</span>() <span class="keyword">unless</span> fs

            <span class="property">@facetOpenState</span>.arr = fs</pre></div></div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>Initialize facet open/close state array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        initFacetOpenState: () =&gt;

            window.facets.each (f) =&gt;

                <span class="property">@facetOpenState</span>.push cat: f.get(<span class="string">'name'</span>), field: <span class="string">'facet'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>Catch a click anywhere in the app</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        documentClick: () =&gt;

            <span class="property">@hideEntitiesMenu</span>()

            $(<span class="string">'#columnsMenu'</span>).hide().removeClass <span class="string">'active'</span>

            $(<span class="string">'#columnOptions'</span>).hide()</pre></div></div>
            
        </li>
        
        
        <li id="section-222">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-222">&#182;</a>
              </div>
              <p>Get the thumbnail label used in thumbnail views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getThumbnailLabel: (m) =&gt;

            thumbnails = window.Settings.Schema.getThumbnails()

            label = []

            _.each thumbnails, (f) =&gt;  label.push m[f.id]

            label.join <span class="string">' '</span></pre></div></div>
            
        </li>
        
        
        <li id="section-223">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-223">&#182;</a>
              </div>
              <p>Gets the key name for the img fields, useful for templates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getPicKey: () =&gt;

            pictures = window.Settings.Schema.getPictures()

            <span class="keyword">return</span> pictures[<span class="number">0</span>][<span class="string">'id'</span>] <span class="keyword">if</span> pictures[<span class="number">0</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-224">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-224">&#182;</a>
              </div>
              <p>Checks if id is a valid tuple field</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        isTuple: (id) =&gt;

            tuples = window.Settings.Schema.getTuples()

            allTuples = []

            _.each tuples, (t) =&gt;

                allTuples.push t.id.split(<span class="string">':'</span>)[<span class="number">0</span>]

                allTuples.push t.id.split(<span class="string">':'</span>)[<span class="number">1</span>]

            <span class="keyword">return</span> <span class="literal">no</span> <span class="keyword">if</span> allTuples.indexOf(id) <span class="keyword">is</span> -<span class="number">1</span>
            <span class="keyword">return</span> <span class="literal">yes</span></pre></div></div>
            
        </li>
        
        
        <li id="section-225">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-225">&#182;</a>
              </div>
              <p>Forms a string of selected item ids concatenated by &#39;|&#39;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        groupIds: () =&gt;

            ids = []

            _.each window.App.itemSelection.each (m) =&gt;

                ids.push m.get <span class="string">'id'</span>

            ids.join <span class="string">'|'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-226">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-226">&#182;</a>
              </div>
              <p>Check if browsing from an iPad/Android device</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        isTablet: () =&gt;

            <span class="keyword">return</span> navigator.userAgent.match(<span class="regexp">/iPad|Android/i</span>) <span class="keyword">isnt</span> <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-227">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-227">&#182;</a>
              </div>
              <p>Keep an array of the selected facet fields
TODO Use a backbone collection for this</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        filterSelection: <span class="keyword">new</span> window.FacetArray</pre></div></div>
            
        </li>
        
        
        <li id="section-228">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-228">&#182;</a>
              </div>
              <p>Keep an array of the facets expanded/folded state
TODO Use a backbone collection for this</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        facetOpenState: <span class="keyword">new</span> window.FacetArray</pre></div></div>
            
        </li>
        
        
        <li id="section-229">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-229">&#182;</a>
              </div>
              <p>Array to store the selected item ids</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        itemSelection: <span class="keyword">new</span> window.Collection</pre></div></div>
            
        </li>
        
        
        <li id="section-230">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-230">&#182;</a>
              </div>
              <p>Lets create our app!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@App</span> = <span class="keyword">new</span> AppView</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
